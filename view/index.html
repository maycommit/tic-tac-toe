<!DOCTYPE html>
<html lang="en">
    <head>
      <title>Tic tac toe</title>
      <style>
        body {
            font-family: "Arial", sans-serif;
        }

        section {
            text-align: center;
        }

        .game--title {
            font-size: 100px;
            color: #d7a62f;
            margin: 10px auto;
        }

        .game--container {
            display: grid;
            grid-template-columns: repeat(3, auto);
            width: 306px;
            margin: 10px auto;
            background-color: #11213a;
            color: #04c0b2;
        }

        .cell {
            font-family: "Permanent Marker", cursive;
            width: 100px;
            height: 100px;
            box-shadow: 2px 2px 2px 2px #ecd7ba;
            border: 2px solid #ecd7ba;
            cursor: pointer;
            line-height: 100px;
            font-size: 60px;
        }

        .game--status {
            font-size: 50px;
            color: #d7a62f;
            margin: 20px auto;
        }

        .game--restart {
            background-color: #f7e4ac;
            width: 200px;
            height: 50px;
            font-size: 25px;
            color: #5586e2;
            box-shadow: 2px 2px 2px 2px #d86c23;
            border: 2px solid #d86c23;
        }
      </style>
    </head>
    <body>
      <section>
        <h1 class="game--title">Tic Tac Toe</h1>
        <div class="game--container">
            <div data-cell-index="0 0" class="cell"></div>
            <div data-cell-index="0 1" class="cell"></div>
            <div data-cell-index="0 2" class="cell"></div>
            <div data-cell-index="1 0" class="cell"></div>
            <div data-cell-index="1 1" class="cell"></div>
            <div data-cell-index="1 2" class="cell"></div>
            <div data-cell-index="2 0" class="cell"></div>
            <div data-cell-index="2 1" class="cell"></div>
            <div data-cell-index="2 2" class="cell"></div>
        </div>
        <h2 class="game--status"></h2>
        <button class="game--restart">Restart Game</button>
      </section>

      <script>
        const player1 = 'X'
        const player2 = 'O'

        let gameState = [['', '', ''], ['', '', ''], ['', '', '']]
        let currentPlayer = player1

        const handleCellPlayed = (x, y) => {
            gameState[x][y] = currentPlayer;
            const clickedCell = document.querySelector(`[data-cell-index="${x} ${y}"]`)
            clickedCell.innerHTML = currentPlayer;
            currentPlayer = currentPlayer === player1 ? player2 : player1
        }

        const handleCellClick = (websocket) => (clickedCellEvent) => {
            const clickedCell = clickedCellEvent.target;
            const [x, y] = clickedCell.getAttribute('data-cell-index')
              .split(' ')
              .map(index => parseInt(index));

            if (gameState[x][y] !== "") {
                return;
            }

            websocket.send(JSON.stringify({ x, y }))
            handleCellPlayed(x, y);
        }
        window.addEventListener("DOMContentLoaded", () => {
          const messages = document.createElement("ul");
          document.body.appendChild(messages);

          const websocket = new WebSocket("ws://localhost:8765/");

          document.querySelectorAll('.cell').forEach(cell => cell.addEventListener('click', handleCellClick(websocket)));

          websocket.addEventListener("message", ({ data }) => {
            const event = JSON.parse(data);
            switch (event.type) {
              case 'MOVEMENT':
                console.log(data)
                const {x , y} = JSON.parse(data)
                handleCellPlayed(parseInt(x), parseInt(y))
            }
          })
        });
      </script>
    </body>
</html>
